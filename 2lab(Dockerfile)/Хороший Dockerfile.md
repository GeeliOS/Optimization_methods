# Хороший Dockerfile

В данном Dockerfile устанавливаются два пакета:

1. **curl**: Это инструмент командной строки для передачи данных с использованием различных протоколов, таких как HTTP, HTTPS, FTP и других. Его часто используют для тестирования API, загрузки файлов и выполнения HTTP-запросов.

2. **git**: Это система контроля версий, которая позволяет разработчикам отслеживать изменения в коде, collaborate с другими и управлять различными версиями проекта.

Давайте приступим к установке:

**1. Базовый образ**

dockerfile
FROM ubuntu:20.04

Эта команда указывает, что базовым образом для создания нового Docker-образа будет `ubuntu:20.04`. Использование конкретной версии (в данном случае 20.04) важно для обеспечения стабильности. Это гарантирует, что установленный программный стек не будет изменяться без вашего ведома, что предотвращает потенциальные проблемы совместимости при сборке образа.

**2. Установка пакетов с явным указанием версии**

dockerfile
RUN apt-get update && apt-get install -y \
 curl=7.68.0-1ubuntu2.6 \
 git=1:2.25.1-1ubuntu3.2

В этом блоке:

- `RUN` — это команда, которая выполняет команды внутри контейнера на этапе сборки образа.
- `apt-get update` обновляет список доступных пакетов и их версий, что позволяет системе знать, какие пакеты могут быть установлены.
- `apt-get install -y` устанавливает указанные пакеты. Флаг `-y` позволяет установить пакеты без подтверждения (вводить `yes` при запросе).
- `curl=7.68.0-1ubuntu2.6` и `git=1:2.25.1-1ubuntu3.2` указывают конкретные версии пакетов `curl` и `git`, которые будут установлены. Явное указание версий помогает избежать проблем, связанных с изменениями в более новых версиях этих пакетов.

**3. Установка рабочего каталога**

dockerfile
WORKDIR /app

Команда `WORKDIR` устанавливает рабочий каталог для всех последующих команд в Dockerfile. Это означает, что все команды после этой строки будут выполняться в каталоге `/app`. Это полезно для управления файлами, так как вам не нужно будет указывать полный путь к файлам: все команды будут относиться к указанному рабочему каталогу.

**4. Выборочное копирование необходимых файлов**

dockerfile
COPY requirements.txt ./
RUN pip install -r requirements.txt
COPY . .

В этом блоке происходит:

- `COPY requirements.txt ./` — копирует файл `requirements.txt` из текущей локальной директории (где находится Dockerfile) в рабочий каталог контейнера (`/app`). Этот файл содержит список зависимостей Python, необходимых для приложения.
- `RUN pip install -r requirements.txt` — выполняет установку библиотек Python, перечисленных в `requirements.txt`. Это требуемые зависимости для работы вашего приложения.
- `COPY . .` — копирует все оставшиеся файлы из текущей директории на хост-машине в рабочий каталог контейнера (`/app`). Это необходимо для обеспечения доступа к всем исходным кодам вашего приложения и другим необходимым файлам.

**5. Запуск приложения в установленном каталоге**

dockerfile
CMD ["python", "app.py"]

Эта команда указывает, что при запуске контейнера будет выполнена команда `python app.py`. Поскольку мы использовали `WORKDIR` для установки рабочего каталога, Python будет искать файл `app.py` в директории `/app`. Команда `CMD` определяет, какой процесс будет запущен, когда создается контейнер из этого образа.

**Итог:**

Этот Dockerfile демонстрирует исправленые практики такие как:

- **Явное указание версий** пакетов помогает избегать проблем с несовместимостью в будущем.
- **Установка рабочего каталога** с помощью `WORKDIR` упрощает управление файлами.
- **Выборочное копирование файлов** (например, сначала `requirements.txt`, затем всего остального) позволяет оптимизировать процесс сборки, минимизировать размер образа и обеспечивать его эффективность.
